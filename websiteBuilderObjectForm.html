<form name="inputForm" method="post" autocomplete="on">

<input name="file" id="getimage" type="file" accept="image/*"> <!-- ng-model="user.pictureFile"-->

<input type="text" id="personnumber" placeholder="ååmmddXXXX" name="userPersonalNumber" pattern="[0-9]{10}" required>   <!-- ng-model="user.orgnr" -->

<input type="text" id="user-name" placeholder="Förnamn Efternamn" name="userName" required> <!-- ng-model="user.name" ng-model-options="{debounce: 1000}" ng-change="autofillDomain(user.name,user.domainname)" -->

<input type="email"  id="user-email" placeholder="example@gmail.com" name="userEmail" required> <!-- ng-change="activateCreatePageButton()" ng-model="user.email" -->

<input type="text" id="user-phone" placeholder="0701234567" name="userPhone" required> <!-- ng-model="user.phone" -->

<input type="text" id="user-address" placeholder="Kungsgatan 1" name="userAddress" required> <!-- ng-model="user.address1" -->

<input type="text" id="user-city" name="userCity" required> <!-- ng-model="user.city" ng-init="user.city='Stockholm'" -->

<input type="text" id="user-zipcode" placeholder="12345" name="userZipcode" required> <!-- ng-model="user.zipcode" -->

<input type="text" id="user-countrycode" name="userCountrycode" required> <!-- country-select is-eu="isEUboolean" ng-model="user.countrycode" -->

<button type="submit">Submit</button>
</form>


<script>

var DEBUG_MODE = true;

var SERVER_URL = 'https://www.weld.io/';
if (DEBUG_MODE === 'staging') {
	SERVER_URL = 'https://weld-staging.herokuapp.com/';
}
else if (DEBUG_MODE) {
	SERVER_URL = 'http://localhost:9000/';
}

$(document).ready(function() {

		// process the form
		$('form').submit(function(e) {

			// TODO: Add Country Code picker
			// TODO: Add image uploader (Base-64)
			// TODO: Add pictureFile to the User object below
			
			// Convert the personal number into a hyphen separated orgnr
			var orgnrGenerator = function() {
				var matches = $('input[name=userPersonalNumber]').val().match(/^(19|20)?([0-9]{6})[- ]?([0-9]{4})$/);
				var newOrgNr = matches[2] + '-' + matches[3];
				return newOrgNr;
			};

			var user = {
				'orgnr': orgnrGenerator(),
				'name': $('input[name=userName]').val(),
				'email': $('input[name=userEmail]').val(),
				'phone': $('input[name=userPhone]').val(),
				'address1': $('input[name=userAddress]').val(),
				'city': $('input[name=userCity]').val(),
				'zipcode': $('input[name=userZipcode]').val(),
				'countrycode': $('input[name=userCountrycode]').val(),
				'tags': []
			};

			var searchDomain = _.throttle(function(domain) {
				// Do a jQuery GET request to our domain-staging
				// TODO: Change to the production server
				var searchDomainUrl = "https://domain-staging.herokuapp.com/api/domain/" + user.domainname + '.se';
				$.get('searchDomainUrl', function(user) {
							// TODO: Pass in our user object with our search
							// place success code here
							// searchDomainNU(); // TODO: Run searchDomainNU() from in here
					})
				.fail(function(data) {
						// place error code here
						console.log("Error: ", data);
				});
			}, 3000);

			// After searching for a .SE domain, proceed to search for a .NU domain
			var searchDomainNU = _.throttle(function(domain) {
				// Do a jQuery GET request to our domain-staging
				// TODO: Change to the production server
				var searchDomainUrl = "https://domain-staging.herokuapp.com/api/domain/" + user.domainname + '.nu';
				$.get('searchDomainUrl', function(user) {
							// TODO: Pass in our user object with our search
							// place success code here
					})
				.fail(function(data) {
						// place error code here
						console.log("Error: ", data);
				});
			}, 3000);

			var autofillDomain = function() {
				user.domainname = user.name.toLowerCase().replace(/[\s]/g, '');
				searchDomain();
			};

			$('input[name=userName]').on('change', _.debounce(autofillDomain, 1000));


			// TODO: Add buttons if domain is available or not.
			// TODO: Add link to terms.
			// TODO: Set user.domainname equal to the chosen one

			var register = function() {

				// TODO: Set user.orgnr - Refer to lines 121 & 122 in festivalminne's app.js
				var data = JSON.stringify(user);
				var registerUrl = SERVER_URL + 'api/users'; 
				$.post(registerUrl, data)
				.done(function(data) {
					console.log("Data loaded: ", data)
				})
				.fail(function() {
					console.log("Error registering");
				})
				;
			};

		e.preventDefault();
		});

});

</script>